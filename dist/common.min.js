export const windowPromise=new Promise((t=>{window.addEventListener("load",(()=>t()))}));export function currentTheme(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}export async function getJson(t){const s=`./dist/${t}.json`,i=await fetch(s);if(i.status>299)throw Error("Error in requesting file, status:"+i.status);const e=i.headers.get("Content-Type");if(!e||!e.startsWith("application/json"))throw Error("Invalid mime type for response, expected application/json, got "+e);return i.json()}export function parseScores(t,s){const i=decodeURIComponent(t).split(",").map((t=>parseFloat(t))),e=i.some((t=>t>100||t<0||isNaN(t)));if(i.length!==s||e)throw Error("Invalid scores");return i}function t(t){const s=new Image;return s.src="./assets/values/"+t,new Promise(((t,i)=>{s.addEventListener("load",(()=>t(s))),s.addEventListener("abort",i),s.addEventListener("error",i)}))}export class Canvas{ctx;params;constructor(t,s){t.width=s.width,t.height=s.height;const i=t.getContext("2d");if(!i)throw Error("Failed to get canvas context");this.ctx=i,this.params=s,this.ctx.fillStyle=this.params.bg,this.ctx.fillRect(0,0,this.params.width,this.params.height)}t(t){this.ctx.strokeStyle="#000",this.ctx.lineJoin="round",this.ctx.lineWidth=75,this.ctx.fillStyle="#222222",this.ctx.strokeRect(165,50+t,470,0)}i(t,s,i,e,r){const[o,n]=r?[1.5,.5]:[.5,1.5];this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(t,s,i,o*Math.PI,n*Math.PI),this.ctx.fill()}o(t,s,i){this.ctx.lineWidth=65;const e=220+120*i;let[r,o]=t.color;const[n,h]=s>98?[r,r]:s<2?[o,o]:[r,o];this.i(166,e,32,n,!1),this.i(634,e,32,h,!0);const a=s>98||s<2?6:0,c=4.82*(Math.max(Math.min(s,98),2)-2);this.ctx.fillStyle=n,this.ctx.fillRect(166,e-32,c+a,64),this.ctx.fillStyle=h,this.ctx.fillRect(172+c,e-32,464-c,64)}h(t,s,i){this.ctx.font=`32px '${this.params.font}', sans-serif`;const e=120*i+232.5;if(null==s||s>100||s<0)throw Error("Invalid score: "+s);const r=t.white,o=[2&r,1&r];s>20&&(this.ctx.fillStyle=o[0]?"#FFF":"#000",this.ctx.textAlign="left",this.ctx.fillText(s.toFixed(1)+"%",150,e)),s<80&&(this.ctx.fillStyle=o[1]?"#FFF":"#000",this.ctx.textAlign="right",this.ctx.fillText((100-s).toFixed(1)+"%",650,e)),this.ctx.fillStyle=this.params.fg,this.ctx.textAlign="center",this.ctx.font=`bold 30px '${this.params.font}', sans-serif`;const n=(h=t.name).charAt(0).toUpperCase()+h.slice(1);var h;const a=Canvas.findTier(s,t.tiers),c=`${n} Axis: ${a}`;return this.ctx.fillText(c,400,170+120*i,550),a}clearFields(){this.ctx.fillStyle=this.params.bg,this.ctx.fillRect(126,130,550,1e3),this.ctx.fillRect(0,0,800,150)}async drawValue(s,i,e,r=!0){const o=170+120*e;this.t(o),this.o(s,i,e);const n=this.h(s,i,e);if(r){const{icons:i}=s,[e,r]=await Promise.all(i.map(t));this.ctx.drawImage(e,20,o,100,100),this.ctx.drawImage(r,680,o,100,100)}return n}drawHeader(t){this.ctx.fillStyle=this.params.fg,this.ctx.font=`700 50px '${this.params.font}', sans-serif`,this.ctx.textAlign="left",this.ctx.fillText("PCBValues",20,90),this.ctx.font=`30px '${this.params.font}', sans-serif`;const s=t.gallery?t.user:"Closest match: "+t.user;this.ctx.fillText(s,20,130,480),this.ctx.textAlign="right",this.ctx.font=`300 25px '${this.params.font}', sans-serif`,this.ctx.fillText("pcbvalues.github.io",780,40),this.ctx.fillText(t.version,780,70),this.ctx.fillText(t.edition,780,100);const i=(new Date).toLocaleDateString("en-GB"),e=`${t.gallery?"Viewed":"Taken"} on ${i}`;this.ctx.fillText(e,780,130)}static findTier(t,s){return s[Math.floor((100-t)/100*s.length)]??s.at(-1)}static download(t){const s=document.createElement("a");s.href=t.toDataURL("image/png"),s.download="PCBValues.png",s.click(),s.remove()}}